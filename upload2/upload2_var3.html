<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Random Selector</title>
<style>
    body {
        font-family: sans-serif;
        margin: 20px;
    }
    textarea {
        width: 400px;
        height: 120px;
        margin-bottom: 10px;
        font-size: 14px;
    }
    #displayContainer {
        display: flex;
        gap: 20px; /* 画像とテキストの間隔 */
        align-items: flex-start;
    }

    #imageArea {
        width: 400px;
        height: 400px;
        border: 1px solid #aaa;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f8f8;
    }

    #imageArea img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    #textOutput {
        width: 200px;
        height: 400px;
    }
</style>
</head>
<body>
<p>Category</p>
<div>
<textarea id="textInput"></textarea>
</div>

<div>
<button id="uploadBtn">ファイル選択</button>
<input type="file" id="fileInput" accept="image/*" multiple style="display:none;">
<button id="selectBtn">セレクト</button>
<button id="clearBtn">クリア</button>
</div>
<br>

<div id="displayContainer">
    <div id="imageArea"></div>
    <textarea id="textOutput" readonly></textarea>
</div>
<div><button id="selectBtn2">Select</button></div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p>***</p>

<script>
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const selectBtn = document.getElementById("selectBtn");
    const selectBtn2 = document.getElementById("selectBtn2");
    const clearBtn = document.getElementById("clearBtn");
    const imageArea = document.getElementById("imageArea");
    const textInput = document.getElementById("textInput");
    const textOutput = document.getElementById("textOutput");

    // メモリ上に保持する画像データ（DataURL）
    let images = [];

    // 画像アップロードボタン → input[type=file] を開く
    uploadBtn.addEventListener("click", () => {
        fileInput.click();
    });

    // ファイル選択時
    fileInput.addEventListener("change", (event) => {
        const files = event.target.files;
        images = []; // 新規アップロードでリセット（必要なら push 追加方式にもできる）

        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                images.push(e.target.result);
            };
            reader.readAsDataURL(file);
        });
    });

    // セレクトボタン
    let selectfn = () => {
        // テキスト行を抽出（空行除外）
        let rawlines = textInput.value
            .split(/\r?\n/)
            .map(line => line.trim());
        if (rawlines.length >= 3 && rawlines[0].length != 0 && rawlines[1].length == 0) {
            rawlines.splice(0, 2);
        }
        const lines = rawlines
            .filter(line => line.length > 0);

        if (lines.length === 0) {
            alert("テキストがありません。");
            return;
        }
        if (images.length === 0) {
            alert("画像がアップロードされていません。");
            return;
        }

        // ランダム選択
        const randomText = lines[Math.floor(Math.random() * lines.length)];
        const randomImage = images[Math.floor(Math.random() * images.length)];

        // テキスト表示
        textOutput.value = randomText;

        // 画像表示
        imageArea.innerHTML = "";
        const img = document.createElement("img");
        img.src = randomImage;
        imageArea.appendChild(img);
    };

    selectBtn.addEventListener("click",selectfn);
    selectBtn2.addEventListener("click",selectfn);

    // クリアボタン
    clearBtn.addEventListener("click", () => {
      textInput.value = "";
    })
</script>

</body>
</html>